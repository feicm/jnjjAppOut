var App=function(){function t(t,n,a){var i={curHeight:null,init:function(){this.name=t,n.wrap&&(this.wrap=n.wrap),this.currentpage=this.wrap.children().eq(0),this.initDomFlag(),a&&(this.callback=a)},initDomFlag:function(){{var t=this,e=t.wrap,n=e.children();n.length}e.css("position","relative"),t.setCurPageHeight(),n.each(function(t){var e=t-0,n=100*e+"%";$(this).attr("id","page_"+e),$(this).css({position:"absolute",left:n,top:0})}),n.each(function(e){var n=e,a=$(this).find(".ui_btn[data-rel]");a.each(function(){"pre"===$(this).attr("data-rel")&&t.bindEvent($(this),n,n-1),"next"===$(this).attr("data-rel")&&t.bindEvent($(this),n,n+1)})})},bindEvent:function(t,e,n){var a=this,i=t,s=$("#page_"+e),o=$("#page_"+n);e>n?i.on("click",function(){console.log("go back"),a.toggle(s,o,"right")}):i.on("click",function(){console.log("go ahead"),a.toggle(s,o,"left")})},toggle:function(t,e,n){switch(n){case"left":t.animate({left:"-100%",opacity:"0","z-index":"0"},200,"ease-out"),e.animate({left:"0",opacity:"1"},200,"ease-out");break;case"right":t.animate({left:"100%",opacity:"0","z-index":"0"},200,"ease-out"),e.animate({left:"0",opacity:"1"},200,"ease-out")}this.currentpage=e,this.setCurPageHeight()},setCurPageHeight:function(){var t=this;t.curHeight=t.currentpage.height(),t.currentpage.css("z-index",1111),t.wrap.css({height:t.curHeight})}},m={tipsMap:{card:"格式:3701XXXXXXXXXXXXXX",mail:"格式:name@domain.com",user:"用户名含6-11位的数字或字母",cnuser:"姓名含1-20字",psd:"密码含6-20位",mobile:"手机号码含11位数字",car:"格式:M1111",archive:"档案编号12位纯数字",car2:"车辆识别代号17位",lsh:"流水号1-13位",record:"记录号12位字母或数字"},init:function(){this.doms=n.doms,this.render(),this.bindEvent()},render:function(){var t,e,n=this,a='<a class="close">X</a>';n.doms.each(function(){t=$(this).find(".item-input"),e=t.find("input").prop("readonly"),!e&&t.append(a)})},bindEvent:function(){var t,e=this;e.doms.each(function(){t=$(this).find(".item-input"),t.each(function(){var t,n;n=$(this).find("input"),t=$(this).find("a.close"),t.on("click",function(){var t=$(this).parent().children("input");t.val(""),t.focus(),$(this).css("display","none")}),n.on("focus",function(){t.css("display","block")}),n.on("blur",function(){e.verify($(this),t)}),n.on("input",function(){e.verify($(this),t)})})})},verify:function(t,e){var n,a,i,s,o=this;s=t.attr("data-type"),a=t.val(),s&&(n=o.validationer(s,a),n?o.removeTips(t):(i=o.tipsMap[s],o.popTips(t,i))),!a&&e.css("display","none")},validationer:function(t,e){var n;switch(t){case"card":n=v(e);break;case"mail":n=p(e);break;case"user":n=u(e);break;case"cnuser":n=d(e);break;case"psd":n=h(e);break;case"mobile":n=c(e);break;case"car":n=r(e);break;case"archive":n=l(e);break;case"car2":n=o(e);break;case"lsh":n=f(e);break;case"record":n=s(e);break;default:console.log("这是一个彩蛋，买彩票去吧！")}return n},popTips:function(t,e){var n=t.parent(),a='<b class="tips">'+e+"</b>",i=n.find(".tips");i.length||n.append(a)},removeTips:function(t){var e=t.parent(),n=e.find(".tips");n&&n.remove()}},g={init:function(){this.dom=n.dom,n.hoverClassName&&(this.hoverClassName=n.hoverClassName),this.off=n.off||!1,!this.off&&this.bindEvent(),this.off&&this.removeEvent()},bindEvent:function(){var t=this,e=t.dom,n=t.hoverClassName;e.on("touchstart",function(){$(this).addClass(n)}),e.on("touchend",function(){$(this).removeClass(n)})},removeEvent:function(){var t=this,e=t.dom;e.off("touchstart"),e.off("touchend")}},b={init:function(){this.dom=n.dom,this.url=n.url,this.dataType=n.dataType||null,this.params=n.data,this.module=n.module||null,this.callback=a||null;var t=this;e(t.url,t.params,function(e){t.initSelect(e)})},initSelect:function(t){var e,n,a=this,i=[],s=a.module;if(t.msg&&(e=t.msg),t[s+"QueryResponse"]&&(e=t[s+"QueryResponse"][s+"List"]),t[s+"Response"]&&(e=t[s+"Response"][s+"List"]),"Object"===a.dataType)for(var o in e)i.push("<option value='"+e[o].key+"'>"+e[o].name+"</option>");else if("Wfddbh"===a.dataType)for(var o in e)i.push("<option value='"+e[o].ddbh+"'>"+e[o].ddmc+"</option>");if(s){if("car"===s)for(var o in e)i.push("<option data-type='"+e[o].carNumType+"' value='"+e[o].carid+"'>"+e[o].carid+"</option>");if("license"===s)for(var o in e)i.push("<option value='"+e[o].licenseid+"'>"+e[o].licenseName+"</option>");if("carType"===s||"identityType"===s||"cgsCommon"===s)for(var o in e)i.push("<option value='"+e[o].key+"'>"+e[o].name+"</option>");if(!e.length)return i.push("<option>未绑定</option>"),n=i.join(""),a.dom.append(n),void a.dom.attr("disabled","disabled")}n=i.join(""),a.dom.append(n),n&&a.dom.mobiscroll().select({theme:"ios7",lang:"zh",display:"bottom",mode:"scroller",minWidth:200}),a.callback&&a.callback()}},k={init:function(){this.dom=n.dom,this.activeClass=n.activeClass,this.defaultClass=n.defaultClass||null,this.bindEvent()},bindEvent:function(){var t=this,e=t.activeClass,n=t.defaultClass,a=t.dom.children();a.each(function(){$(this).on("click",function(){var t=$(this),i=t.attr("data-for"),s=$("#"+i);t.hasClass(e)&&n&&t.removeClass(n),t.addClass(e),s.show(),a.each(function(){var t=$(this);t.attr("data-for")!==i&&(t.removeClass(e),n&&t.addClass(n),$("#"+t.attr("data-for")).hide())})})})}},C={curBlock:null,init:function(){this.dom=n.dom,this.bindEvent()},bindEvent:function(){var t=this,e=t.dom.val();t.dom.on("change",function(){var e=$(this).val();t.toggleBlock(e)}),e&&t.toggleBlock(e)},toggleBlock:function(t){if(t){var e=$("#"+t);this.curBlock&&this.curBlock.selector===e.selector||(this.curBlock&&this.curBlock.hide("linear"),e.show("linear"),this.curBlock=e)}}},w={oldVal:"",newVal:"",init:function(){this.btn=n.btn,this.listener=n.listener||null,this.listenerArg=n.listenerArg||null,this.inputs=n.inputs,this.disableClass=n.disableClass,this.hoverClass=n.hoverClass,this.callback=a,this.disableBtn(),this.bindEvent()},bindEvent:function(){var t,e,n=this;n.inputs.each(function(){t=$(this),e=t.val(),t.on("focus",function(){n.oldVal=$(this).val(),n.toggleBtnHighlight(),n.newVal=""}),t.on("blur",function(){n.newVal=$(this).val(),n.toggleBtnHighlight(),n.oldVal=n.newVal}),"checkbox"===t.attr("type")&&(n.oldVal="",t.on("change",function(){n.newVal=$(this).prop("checked")?"checked":"",n.toggleBtnHighlight()}))})},toggleBtnHighlight:function(){var t=this,e=t.getBtnStatus(),n=t.getInputsStatus(),a=t.hasChangeVal(t.oldVal,t.newVal);if(n&&a){if(t.newVal="","active"===e)return;t.enableBtn()}else{if(t.newVal="",""===e)return;t.disableBtn()}},enableBtn:function(){var t=this,e=t.btn,n=t.listener,a=t.listenerArg,i=t.disableClass,s=t.hoverClass,o=t.callback;e.removeClass(i),e.attr("data-status","active"),App.UI("buttonHover",{dom:e,hoverClassName:s}),n&&e.on("click",function(){a?n(a):n()}),o&&o(e)},disableBtn:function(){var t=this,e=t.btn,n=t.disableClass,a=t.hoverClass;e.addClass(n),e.attr("data-status",""),App.UI("buttonHover",{dom:e,hoverClassName:a,off:!0}),e.off("click")},getBtnStatus:function(){return this.btn.attr("data-status")},getInputsStatus:function(){var t,e,n=this,a=n.inputs,i=!1;return a.each(function(){var n=$(this);t=n.parent().find(".tips").length,e=n.val(),i=e&&!t?"checkbox"===n.attr("type")?n.prop("checked")?!0:!1:!0:!1}),i},hasChangeVal:function(t,e){return!(t===e)}},y={current:null,init:function(){return this.type=n.type||null,this.title=n.title||null,this.msg=n.msg||"",this.OkTxt=n.OkTxt||"确定",this.CancelTxt=n.CancelTxt||"取消",this.callback=a||null,this.show(),this.bindEvent(),this},show:function(){var t=this,e=$(t.getHtml());$("body").append(e),setTimeout(function(){e.addClass("modal-in")},10),this.current=e},bindEvent:function(){var t=this,e=t.current,n=e.find(".modal-button");n.length&&n.on("click",function(){var e=$(this),n=e.data("action");return"OK"===n?(t.callback&&t.callback("OK"),t.remove()):"CANCEL"===n&&(t.callback&&t.callback("CANCEL"),t.remove()),!0})},remove:function(){var t=this;t.current.removeClass("modal-in").addClass("modal-out"),t.current.remove()},getHtml:function(){var t,e=this,n=e.type,a=e.title,i=e.msg,s=e.OkTxt,o=e.CancelTxt;switch(n){case"alert":t=['<div class="modal">','    <div class="modal-inner">','        <div class="modal-title">'+a+"</div>",'        <div class="modal-text">'+i+"</div>","    </div>",'    <div class="modal-buttons ">        <span class="modal-button modal-button-bold" data-action="OK">确定</span>    </div>',"</div>",'<div class="ui-layer ui-layer-01"></div>'].join("");break;case"confirm":t=['<div class="modal">','    <div class="modal-inner">','        <div class="modal-title">'+a+"</div>",'        <div class="modal-text">'+i+"</div>","    </div>",'    <div class="modal-buttons ">','        <span class="modal-button modal-button-bold" data-action="OK">'+s+"</span>",'        <span class="modal-button modal-button-bold" data-action="CANCEL">'+o+"</span>","    </div>","</div>",'<div class="ui-layer ui-layer-01"></div>'].join("");break;default:t=['<div class="ui-loading">','    <div class="ico-loading"></div>','    <b class="msg">'+i+"</b>","</div>",'<div class="ui-layer"></div>'].join("")}return t},resetMsg:function(t){var e=this;return t&&(e.msg=t),e.remove(),e.show(),this}},E={changePage:i,inputClose:m,buttonHover:g,tabToggle:k,select:b,toggleSelectBlock:C,btnHighlightWithInput:w,dialog:y};return t&&E[t].init()}function e(t,e,n,a){var i={type:a||"GET",url:t,data:e,dataType:"json"};$.ajax(i).done(function(t){t&&n&&n(t)}).fail(function(){n&&n("error")})}function n(t){var e,n,a,i={},s=[];if(n=t.substring(1,t.length),s=n.split("@"),a=s.length)for(var o=0;a>o;o++)e=s[o].split("="),i[e[0]]=$.trim(e[1]);else e=n.split("="),i[e[0]]=$.trim(e[1]);return i}function a(t){var e,n,a=[];return e=t.split("@@"),e.length>1?(a=e[1].split("="),"webViewPageId"!==a[0]?(console.log("pageid is not find!"),!1):n=a[1]):!1}function i(){return window.addEventListener("offline",function(){App.UI("dialog",{type:"alert",title:"公众服务平台",msg:"您当前处于离线状态，请检查网络连接！"})},!0),window.addEventListener("online",function(){history.go(0)},!0),navigator.onLine?!0:(App.UI("dialog",{type:"alert",title:"公众服务平台",msg:"您当前处于离线状态，请检查网络连接！"}),!1)}function s(t){var e=/^[a-zA-Z0-9]{12}$/;return e.test(t)}function o(t){var e=/^[a-zA-Z0-9]{17}$/;return e.test(t)}function l(t){var e=/^\d{12}$/;return e.test(t)}function r(t){var e=/^[a-zA-Z0-9]{5}$/;return e.test(t)}function c(t){var e=/^(13[0-9]|15[0|2|3|5|6|7|8|9]|18[0|5|6|8|9]|177)\d{8}$/;return e.test(t)}function d(t){var e=/^([\u4E00-\uFA29]|[\uE7C7-\uE7F3]|[a-zA-Z0-9]){1,20}$/;return e.test(t)}function u(t){var e=/^[a-zA-Z0-9]{6,11}$/;return e.test(t)}function h(t){var e=/^\S{6,20}$/;return e.test(t)}function p(t){var e=/^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;return e.test(t)}function v(t){var e={11:"北京",12:"天津",13:"河北",14:"山西",15:"内蒙古",21:"辽宁",22:"吉林",23:"黑龙江",31:"上海",32:"江苏",33:"浙江",34:"安徽",35:"福建",36:"江西",37:"山东",41:"河南",42:"湖北",43:"湖南",44:"广东",45:"广西",46:"海南",50:"重庆",51:"四川",52:"贵州",53:"云南",54:"西藏",61:"陕西",62:"甘肃",63:"青海",64:"宁夏",65:"新疆",71:"台湾",81:"香港",82:"澳门",91:"国外"},n=/(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/,a=0;if(n.test(t)===!1)return!1;if(t=t.replace(/x$/i,"a"),null==e[parseInt(t.substr(0,2))])return!1;sBirthday=t.substr(6,4)+"-"+Number(t.substr(10,2))+"-"+Number(t.substr(12,2));var i=new Date(sBirthday.replace(/-/g,"/"));if(sBirthday!=i.getFullYear()+"-"+(i.getMonth()+1)+"-"+i.getDate())return!1;for(var s=17;s>=0;s--)a+=Math.pow(2,s)%11*parseInt(t.charAt(17-s),11);return a%11!=1?!1:!0}function f(t){var e=/^\S{1,13}$/;return e.test(t)}function m(t){var e=function(t){App.UI("dialog",{type:"alert",title:"公众服务平台",msg:t})};return t.username&&(""===t.username.val()||t.username.parent().find(".tips").length)?(e("用户名错误!"),!1):t.pwdold&&(""===t.pwdold.val()||t.pwdold.parent().find(".tips").length)?(e("旧密码错误!"),!1):t.pwd1&&t.pwd2&&(""===t.pwd1.val()||""===t.pwd2.val()||t.pwd1.parent().find(".tips").length||t.pwd2.parent().find(".tips").length)?(e("密码错误!"),!1):t.pwdnew1&&t.pwdnew2&&(""===t.pwdnew1.val()||""===t.pwdnew2.val()||t.pwdnew1.parent().find(".tips").length||t.pwdnew2.parent().find(".tips").length)?(e("密码错误!"),!1):t.name&&(""===t.name.val()||t.name.parent().find(".tips").length)?(e("姓名填写错误!"),!1):t.phone&&(""===t.phone.val()||t.phone.parent().find(".tips").length)?(e("手机号码错误!"),!1):t.idnum&&(""===t.idnum.val()||t.idnum.parent().find(".tips").length)?(e("身份证号码错误!"),!1):t.clsbdh&&(""===t.clsbdh.val()||t.clsbdh.parent().find(".tips").length)?(e("车辆识别代号错误!"),!1):t.hphm&&(""===t.hphm.val()||t.hphm.parent().find(".tips").length)?(e("号牌号码错误!"),!1):t.dabh&&(""===t.dabh.val()||t.dabh.parent().find(".tips").length)?(e("档案编号错误!"),!1):t.email&&(""===t.email.val()||t.email.parent().find(".tips").length)?(e("邮箱格式错误!"),!1):t.closername&&(""===t.closername.val()||t.closername.parent().find(".tips").length)?(e("密切联系人姓名错误!"),!1):t.closerphone&&(""===t.closerphone.val()||t.closerphone.parent().find(".tips").length)?(e("密切联系人电话错误!"),!1):t.closeridcard&&(""===t.closeridcard.val()||t.closeridcard.parent().find(".tips").length)?(e("密切联系人身份证号错误!"),!1):t.movecarname&&(""===t.movecarname.val()||t.movecarname.parent().find(".tips").length)?(e("移车联系人姓名错误!"),!1):t.movecarphone&&(""===t.movecarphone.val()||t.movecarphone.parent().find(".tips").length)?(e("密切联系人电话号码错误!"),!1):t.sfzmhm&&(""===t.sfzmhm.val()||t.sfzmhm.parent().find(".tips").length)?(e("身份证明号码错误!"),!1):t.lsh&&(""===t.lsh.val()||t.lsh.parent().find(".tips").length)?(e("流水号错误!"),!1):t.sgkcjlh&&(""===t.sgkcjlh.val()||t.sgkcjlh.parent().find(".tips").length)?(e("记录号错误!"),!1):!0}var g={SetCookie:function(t,e,n){var a=arguments,i=arguments.length,n=i>2?a[2]:null,s=i>3?a[3]:null,o=i>4?a[4]:null,l=i>5?a[5]:!1;document.cookie=t+"="+escape(e)+(null==n?"":"; expires="+n.toGMTString())+(null==s?"":"; path="+s)+(null==o?"":"; domain="+o)+(1==l?"; secure":"")},GetCookie:function(t){for(var e=t+"=",n=e.length,a=document.cookie.length,i=0;a>i;){var s=i+n;if(document.cookie.substring(i,s)==e)return this.getCookieVal(s);if(i=document.cookie.indexOf(" ",i)+1,0==i)break}return null},getCookieVal:function(t){var e=document.cookie.indexOf(";",t);return-1==e&&(e=document.cookie.length),unescape(document.cookie.substring(t,e))},ResetCookie:function(){var t=document.getElementById("username").value,e=new Date;this.SetCookie(t,null,e)}},b={set:function(t,e){null!==this.get(t)&&this.remove(t),localStorage.setItem(t,e)},get:function(t){var e=localStorage.getItem(t);return void 0===e?null:e},remove:function(t){localStorage.removeItem(t)},clear:function(){localStorage.clear()},each:function(t){for(var e,n=localStorage.length,a=0,t=t||function(){};n>a&&(e=localStorage.key(a),t.call(this,e,this.get(e))!==!1);a++)localStorage.length<n&&(n--,a--)}};return{UI:t,getAjaxData:e,getHash:n,getPageId:a,addOnlineStatusListener:i,verify:m,Cookie:g,LS:b}}();