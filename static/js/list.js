$(function(){function e(e,a){return e in a}if(!App.addOnlineStatusListener())return!1;var a=App.LS.get("App_userName"),s=App.LS.get("App_baseDomain"),i=(new Date).getTime(),t=App.getPageId(window.location.href),l=jnjjApp.config.requestUrl+"/jnpublic/queryCar.json",r=jnjjApp.config.requestUrl+"/jnpublic/queryLicense.json",n=jnjjApp.config.requestUrl+"/jnpublic/vehFlow.json",c=jnjjApp.config.requestUrl+"/jnpublic/drvFlow.json",o=jnjjApp.config.requestUrl+"/jnpublic/electIllegalquery.json",d=jnjjApp.config.requestUrl+"/jnpublic/violationQuery.json",p=jnjjApp.config.requestUrl+"/jnpublic/vioforcequery.json",u="bindcar.html?@@webViewPageId="+i+Wisp.CommenFunc.getRandom()+"@@",b="bindcard.html?@@webViewPageId="+i+Wisp.CommenFunc.getRandom()+"@@",m={register:a,axisFlag:!1,baseDomain:s},f={moduleCH:{car:"车辆",card:"驾照",violation_car:"已绑定车辆",violation_card:"已绑定驾照",v_car_list:"车辆电子监控",v_card_list:"驾照现场违法信息"},dialog:null,currentBtn:null,preQuestUrl:"adapter?open&url="+jnjjApp.config.requestUrl,urlRouter:{bindcar:"bindcar.html?@@webViewPageId="+i+Wisp.CommenFunc.getRandom()+"@@",bindcard:"bindcard.html?@@webViewPageId="+i+Wisp.CommenFunc.getRandom()+"@@",v_car_list:"resultlist.html",flow_car_list:"flow_car_list.html",flow_card_list:"flow_card_list.html",v_card_list:"resultlisttab.html",bandCar:jnjjApp.config.requestUrl+"/jnpublic/bandCar.json",bandLicense:jnjjApp.config.requestUrl+"/jnpublic/bandLicense.json"},resultUrl:"infodetails.html",init:function(e,a){this.listWrap=e.listWrap,this.tipsWrap=e.tipsWrap,this.defaultBtn=e.defaultBtn||null,this.module=e.module,this.requestUrl=e.requestUrl,this.params=e.datas,this.callback=a||null;var s=this;s.requestData(s.requestUrl,s.params,function(e){var a=[];e.carList&&(a=e.carList),e.licenseList&&(a=e.licenseList),e.vehFlowList&&(a=e.vehFlowList,e=a),e.drvFlowList&&(a=e.drvFlowList,e=a),"true"===e.success&&(a=e.msg),a.length&&null!==a?(s.defaultBtn&&s.hideDefaultBtn(),s.renderList(a),s.bindEvent(),s.callback&&s.callback()):(s.renderList(),s.callback&&s.callback())})},renderList:function(e){var a=this,s=Array.prototype.slice.call(arguments),i=a.listWrap,t=a.tipsWrap,l="",r="";s.length?(l=a.getListHtml(e,a.module),i.append(l),a.setCurrentBtn(a.module),a.dialog.remove()):("car"===a.module||"card"===a.module?(r=['<i class="fl icon icon-larger'+a.module+'"></i>',"<h2>查询更便捷，绑定"+a.moduleCH[a.module]+"</h2>"].join(""),t.append(r)):(l=a.getHtmlNoResult(),i.append(l)),a.dialog.remove())},hideDefaultBtn:function(){var e=this;e.defaultBtn&&e.defaultBtn.remove()},bindEvent:function(){var e=this,i=e.listWrap,t=e.module;return"car"===t||"card"===t?(i.children("li").find("a.db").on("click",function(){e.listListener(t,$(this))}),e.currentBtn.on("click",function(){window.open(e.urlRouter["bind"+t])}),"car"===t?$(".button").each(function(){var i=$(this),t=i.data("opts"),l=e.urlRouter.bandCar,r={register:a,carNumType:t.carNumType,carNum:t.carid.substring(1),carFramId:t.carFramId,optiontype:"N",baseDomain:s};i.on("click",function(){e.unbind(i,l,r)})}):"card"===t&&$(".button").each(function(){var i=$(this),t=i.data("opts"),l=e.urlRouter.bandLicense,r={register:a,licenseid:t.licenseid,optiontype:"N",baseDomain:s};i.on("click",function(){e.unbind(i,l,r)})}),!1):void i.children("li").on("click",function(){e.listListener(t,$(this))})},unbind:function(e,a,s){var i=this;i.dialog=App.UI("dialog",{msg:"解绑中···"}),App.getAjaxData(a,s,function(a){var s;return"error"===a?(i.dialog.remove(),void App.UI("dialog",{type:"alert",title:"公众服务平台",msg:"解绑失败！"})):(a.licenseBandResponse&&(s=a.licenseBandResponse),a.carBandResponse&&(s=a.carBandResponse),void("true"===s.bandSuccess?(i.dialog.resetMsg("解绑成功！"),setTimeout(function(){i.dialog.remove(),e.parents("li").remove()},500)):(i.dialog.remove(),App.UI("dialog",{type:"alert",title:"公众服务平台",msg:"解绑失败！"}))))})},listListener:function(e,a){var s=this,i=a;switch(i.off("click"),e){case"car":var t=i.parent("li").attr("data-cartype"),l=i.parent("li").attr("data-carid"),r=encodeURI("#mode=carquery@cartype="+t+"@carid="+l);window.open(s.resultUrl+r);break;case"card":var n=i.parent("li").attr("data-licenserecord"),r=encodeURI("#mode=cardquery@licenserecord="+n+i.parent("li").data("opts"));window.open(s.resultUrl+r);break;case"violation_car":case"violationHandle_car":var c;c=$("#nodo01").prop("checked")?0:"";var o=i.data("opt"),r=encodeURI("?@@webViewPageId="+(new Date).getTime()+"@@#"+o+"@jkbj="+c);window.open(s.urlRouter.v_car_list+r);break;case"violation_card":var c;c=$("#nodo02").prop("checked")?0:"";var o=i.data("opt"),r=encodeURI("#"+o+"@jkbj="+c);window.open(s.urlRouter.v_card_list+r);break;case"v_car_list":case"v_card_list":case"flow_car_list":case"flow_card_list":var d=i.data("opt"),r=encodeURI("#mode="+e+d);window.open(s.resultUrl+"?@@webViewPageId="+(new Date).getTime()+"@@"+r);break;case"flow_car":var o=i.data("opt"),r=encodeURI("?@@webViewPageId="+(new Date).getTime()+"@@#"+o);window.open(s.urlRouter.flow_car_list+r);break;case"flow_card":var o=i.data("opt"),r=encodeURI("#"+o);window.open(s.urlRouter.flow_card_list+r);break;case"flow_car_list":case"flow_card_list":var d=i.data("opt"),r=encodeURI("#mode="+e+d);window.open(s.resultUrl+"?@@webViewPageId="+(new Date).getTime()+"@@"+r)}i.on("click",function(){s.listListener(e,$(this))})},getListHtml:function(e,a){var s,i,t,l=this,r=e.length,n=[];switch(a){case"car":for(var c=0;r>c;c++)i=['<li data-cartype="'+e[c].carNumType+'" data-carid="'+e[c].carid+'">','    <h1 class="t1">','        <i class="icon icon-car2 fl"></i>',"        <b>"+e[c].carid+"</b>","        <a data-opts="+JSON.stringify(e[c])+' class="button fr fs08">解绑</a>',"    </h1>",'    <a class="db">','        <p class="p1">','            <b class="label01 fl">车主</b>','            <b class="txt02 fr">'+e[c].carowner+"</b>","        </p>",'        <p class="p1">','            <b class="label01 fl">身份证</b>','            <b class="txt02 fr">'+e[c].indentityid.substring(0,4)+"******"+e[c].indentityid.substring(16,18)+"</b>","        </p>",'        <i class="icon01 icon01_arr_r"></i>',"    </a>","</li>"].join(""),n.push(i);t=l.getBtnHtml(a),s=n.join("")+t;break;case"card":for(var c=0;r>c;c++)i=['<li data-opts="@licenseid='+e[c].licenseid+"@licenseName="+e[c].licenseName+'" data-licenserecord="'+e[c].licenseRecord+'">','    <h1 class="t1">','        <i class="icon icon-card2 fl"></i>',"        <b>"+e[c].licenseRecord+"</b>","        <a data-opts="+JSON.stringify(e[c])+' class="button fr fs08">解绑</a>',"    </h1>",'    <a class="db">','        <p class="p1">','            <b class="label01 fl">驾驶人</b>','            <b class="txt02 fr">'+e[c].licenseName+"</b>","        </p>",'        <p class="p1">','            <b class="label01 fl">身份证</b>','            <b class="txt02 fr">'+e[c].licenseid.substring(0,4)+"******"+e[c].licenseid.substring(16,18)+"</b>","        </p>",'        <i class="icon01 icon01_arr_r"></i>',"    </a>","</li>"].join(""),n.push(i);t=l.getBtnHtml(a),s=n.join("")+t;break;case"violation_car":case"violationHandle_car":case"flow_car":for(var c=0;r>c;c++)i=['<li class="list_hover" data-opt="@cartype='+e[c].carNumType+"@carid="+e[c].carid+'">','    <div class="item-content ovh db">','        <div class="ui-pic fl">','            <img src="images/ico_car2.png">',"        </div>",'        <h1 class="h1 bg_arr_r">','            <b class="fw f12">车主姓名</b>&nbsp;&nbsp;<b class="fw f12">'+e[c].carowner+"</b><br>",'            <b class="txt02">号牌号码</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b class="txt02">'+e[c].carid+"</b>","        </h1>","    </div>","</li>"].join(""),n.push(i);s=n.join("");break;case"violation_card":case"flow_card":for(var c=0;r>c;c++)i=['<li class="list_hover" data-opt="@licenseid='+e[c].licenseid+"@licenseName="+e[c].licenseName+'">','    <div class="item-content ovh db">','        <div class="ui-pic fl">','            <img src="images/ico_card2.png">',"        </div>",'        <h1 class="h1 bg_arr_r">','            <b class="fw f12">驾驶人</b>&nbsp;&nbsp;<b class="fw f12">'+e[c].licenseName+"</b><br>",'            <b class="txt02">'+e[c].licenseid.substring(0,4)+"******"+e[c].licenseid.substring(16,18)+"</b>","        </h1>","    </div>","</li>"].join(""),n.push(i);s=n.join("");break;case"v_car_list":case"v_card_list":var o,d=e,p="",u="",b=[];if("NO_RESULT"!==d){d=l.formatData(d),o=d.length;for(var c=0;o>c;c++)u="@wfxw="+d[c].wfxw+"@wfsj="+d[c].wfsj+"@wfdd="+d[c].wfdd,"v_car_list"===a&&(u+="@clqk="+d[c].clqk+"@clsj="+d[c].clsj+"@fkje="+d[c].fkje+"@jkqk="+d[c].jkqk+"@jksj="+d[c].jksj),"v_card_list"===a&&(u+="@wfjfs="+d[c].wfjfs+"@fkje="+d[c].fkje+"@clsj="+d[c].clsj+"@jkqk="+d[c].jkqk+"@jksj="+d[c].jksj+"@jscjsj="+d[c].jscjsj+"@cjbj="+d[c].cjbj+"@cjsj="+d[c].cjsj),p=['<li class="list_hover" data-opt="'+u+'">','    <span class="ui-seal m-list-c1-sts '+("1"===d[c].jkqk||"1"===d[c].cjbj?"dbn":"")+'">未处理</span>','    <div class="top">'+d[c].hphm+"</div>",'    <div class="item-content ovh db">','        <h1 class="h1 bg_arr_r">','            <b class="fw"><i class="icon icon-action"></i>违法行为</b><b class="fw fr mr2 wfxw">'+d[c].wfxw+"</b><br>",'            <b class="fw"><i class="icon icon-time"></i>违法时间</b><b class="fw fr mr2">'+l.formatTime(d[c].wfsj)+"</b>","        </h1>","    </div>","</li>"].join(""),b.push(p)}s=b.join("");break;case"flow_car_list":for(var c=0;r>c;c++)i=['<li data-opt="@lsh='+e[c].lsh+"@ywlx="+e[c].ywlx+"@syr="+e[c].syr+"@hpzl="+e[c].hpzl+"@hphm="+e[c].hphm+"@clpp1="+e[c].clpp1+"@sqrq="+e[c].sqrq+"@bjrq="+e[c].bjrq+"@xygw="+e[c].xygw+'">','    <article class="m_list_c1">',"        <h1>",'            <strong class="label-success fs10 mr05 fl">'+e[c].lsh+"</strong>",'            <em class="fl w100 mt05">业务类型 <b class="fr mr05 color_03">'+e[c].ywlx+"</b></em>",'            <em class="fl w100 mt05">机动车所有人 <b class="fr mr05 color_03">'+e[c].syr+"</b></em>","        </h1>","    </article>","</li>"].join(""),n.push(i);s=n.join("");break;case"flow_card_list":for(var c=0;r>c;c++)i=['<li data-opt="@lsh='+e[c].lsh+"@sfzmhm="+e[c].sfzmhm+"@xm="+e[c].xm+"@ywlx="+e[c].ywlx+"@kssj="+e[c].kssj+"@jssj="+e[c].jssj+"@xygw="+e[c].xygw+'">','    <article class="m_list_c1">',"        <h1>",'            <strong class="label-success fs10 mr05 fl">'+e[c].lsh+"</strong>",'            <em class="fl w100 mt05">业务类型 <b class="fr mr05 color_03">'+e[c].ywlx+"</b></em>",'            <em class="fl w100 mt05">姓名 <b class="fr mr05 color_03">'+e[c].xm+"</b></em>","        </h1>","    </article>","</li>"].join(""),n.push(i);s=n.join("")}return s},getBtnHtml:function(e){var a=['<a class="ui_btn ui_btn_01 ui_radius ui_btn_block" data-mode="'+e+'">',"    +添加绑定","</a>"].join("");return a},getHtmlNoResult:function(e){var a;a="NO_RESULT"===e||void 0===e?"无记录！":e;var s=[' <div class="noresult">',"     <b>"+a+"</b>"," </div>"].join("");return s},setCurrentBtn:function(e){var a=this;$(".ui_btn").data("mode")===e&&(a.currentBtn=$(".ui_btn"),App.UI("buttonHover",{dom:a.currentBtn,hoverClassName:"ui_btn_01_hover"}))},formatData:function(e){for(var a=e.substring(1,e.length-1),s=a.split(",{"),i=s.length,t=0;i>t;t++)t&&(s[t]="{"+s[t]),s[t]=$.parseJSON(s[t]);return console.dir(s),s},formatTime:function(e){return e.split(" ")[0]},requestData:function(e,a,s){{var i=this,t=e,l=a,r=s;i.module}i.dialog=App.UI("dialog",{msg:"数据加载中···"}),App.getAjaxData(t,l,function(e){var a;e.carQueryResponse&&(a=e.carQueryResponse),e.licenseQueryResponse&&(a=e.licenseQueryResponse),e.electIllegalResponse&&(a=e.electIllegalResponse),e.violationInfoResponse&&(a=e.violationInfoResponse),e.vioforceResponse&&(a=e.vioforceResponse),e.vehFlowResponse&&(a=e.vehFlowResponse),e.drvFlowResponse&&(a=e.drvFlowResponse),a?r&&r(a):(i.dialog.remove(),App.UI("dialog",{type:"alert",title:"公众服务平台",msg:i.moduleCH[i.module]+"列表初始化失败！"}))})}},j=$(".c").data("mode");App.LS.set(j,t);var v=decodeURI(window.location.hash),g={};if(v?g=App.getHash(v):console.log("传参失败！"),"car"===j){var _=$("#go_carbindpage");_.on("click",function(){window.open(u)}),f.init({listWrap:$(".ui-list"),tipsWrap:$(".tips"),defaultBtn:_,module:j,requestUrl:l,datas:m})}else if("card"===j){var w=$("#go_cardbindpage");w.on("click",function(){window.open(b)}),f.init({listWrap:$(".ui-list"),tipsWrap:$(".tips"),defaultBtn:w,module:j,requestUrl:r,datas:m})}else if("violation"===j||"flow"===j||"violationHandle"===j)f.init({listWrap:$("#"+j+"_car"),tipsWrap:$(".tips"),module:j+"_car",requestUrl:l,datas:m},function(){"violationHandle"!==j&&f.init({listWrap:$("#"+j+"_card"),tipsWrap:$(".tips"),module:j+"_card",requestUrl:r,datas:m})}),App.UI("tabToggle",{dom:$("#tab_violation"),activeClass:"active"});else if("v_car_list"===j)e("cartype",g)&&e("carid",g)&&e("jkbj",g)&&(m={register:a,carNumType:g.cartype,carNum:decodeURI(g.carid),jkbj:g.jkbj,baseDomain:s},f.init({listWrap:$(".list-block ul"),module:j,requestUrl:o,datas:m}));else if("v_card_list"===j){if(e("licenseid",g)&&e("jkbj",g)){var m={register:a,indentyid:g.licenseid,jkbj:g.jkbj,baseDomain:s};if(""!==g.jkbj)var h={register:a,indentyid:g.licenseid,cjbj:0,baseDomain:s};else var h={register:a,indentyid:g.licenseid,cjbj:"",baseDomain:s};f.init({listWrap:$("#tab-item-01 ul"),module:j,requestUrl:d,datas:m},function(){f.init({listWrap:$("#tab-item-02 ul"),module:j,requestUrl:p,datas:h})}),App.UI("tabToggle",{dom:$("#tab_violation"),activeClass:"active"})}}else"flow_car_list"===j?e("cartype",g)&&e("carid",g)&&(m={register:a,hpzl:g.cartype,hphm:decodeURI(g.carid).substr(1),baseDomain:s},f.init({listWrap:$(".list-block ul"),module:j,requestUrl:n,datas:m})):"flow_card_list"===j&&e("licenseid",g)&&e("licenseName",g)&&(m={register:a,sfzmhm:g.licenseid,xm:decodeURI(g.licenseName),baseDomain:s},f.init({listWrap:$(".list-block ul"),module:j,requestUrl:c,datas:m}));_&&App.UI("buttonHover",{dom:_,hoverClassName:"ui_btn_03_hover"}),w&&App.UI("buttonHover",{dom:w,hoverClassName:"ui_btn_03_hover"})});